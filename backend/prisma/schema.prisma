generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Team {
  id                String      @id @default(uuid())
  teamName          String      @unique
  collegeName       String
  member1           String
  member2           String
  dept              String
  year              Int
  isActive          Boolean     @default(true)
  selectedProblemId String?
  submission        Submission?
}

model Submission {
  id                 String                   @id @default(uuid())
  teamId             String                   @unique
  content            Json
  status             String                   @default("IN_PROGRESS")
  pptUrl             String?
  updatedAt          DateTime                 @updatedAt
  canRegenerate      Boolean                  @default(true)
  prototypeUrl       String?
  submittedAt        DateTime?
  certificateName    String?
  certificateCollege String?
  certificateYear    Int?
  certificates       ParticipantCertificate[]
  team               Team                     @relation(fields: [teamId], references: [id])
  scores             Score[]
}

model Reviewer {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String
  domain    String?
  scores    Score[]
  createdAt DateTime @default(now())
}

model Score {
  id           String     @id @default(uuid())
  submissionId String
  reviewerId   String
  innovation   Int        @default(0)
  feasibility  Int        @default(0)
  techStack    Int        @default(0)
  presentation Int        @default(0)
  impact       Int        @default(0)
  total        Int        @default(0)
  comments     String?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  submission   Submission @relation(fields: [submissionId], references: [id])
  reviewer     Reviewer   @relation(fields: [reviewerId], references: [id])

  @@unique([submissionId, reviewerId]) // Prevent duplicate scores
}

model ParticipantCertificate {
  id             String     @id @default(uuid())
  submissionId   String
  name           String
  college        String
  year           String
  dept           String
  role           String
  certificateUrl String?
  createdAt      DateTime   @default(now())
  submission     Submission @relation(fields: [submissionId], references: [id])
}

model HackathonConfig {
  id                      Int       @id @default(1)
  startTime               DateTime?
  isPaused                Boolean   @default(true)
  durationMinutes         Int       @default(1440)
  pptConfig               Json?
  collegeLogo             String?
  footerText              String?
  eventTheme              Json?
  allowCertificateDetails Boolean   @default(false)
  eventEnded              Boolean   @default(false)
}

model ProblemStatement {
  id           String   @id @default(uuid())
  questionNo   String
  subDivisions String?
  title        String
  description  String
  allottedTo   String?
  createdAt    DateTime @default(now())
}

model Admin {
  id       String @id @default(uuid())
  email    String @unique
  password String
}
